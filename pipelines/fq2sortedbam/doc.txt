# Pipeline Usage Guide

This document explains the command-line arguments for running the pipeline. Below is a detailed description of each argument and its usage.

---

## Arguments

### General Options
- `--ref REF`
  - **Description**: Reference genome path. For BWA, this pipeline expects the index to be present at this location. If the index is not available, it can be generated using the `--rindex` option.

- `--reads READS [READS ...]`
  - **Description**: Input reads. The pipeline expects both reads to be at the same location.

- `--tempdir TEMPDIR`
  - **Description**: Directory for storing intermediate data.

- `--output OUTPUT`
  - **Description**: Prefix location for the output file(s) name.

### Processing Options
- `--simd SIMD`
  - **Description**: Defaults to `avx512` mode. Use `sse` for BWA SSE mode.

- `--read3 READ3`
  - **Description**: Name of `R3` files (for `fqprocess`), separated by spaces.

- `--readi1 READI1`
  - **Description**: Name of `I1` files (for `fqprocess`), separated by spaces.

- `--prefix PREFIX`
  - **Description**: Prefix for processed `R1` and `R3` files for `bwa-mem2`.

- `--suffix SUFFIX`
  - **Description**: Suffix for processed `R1` and `R3` files for `bwa-mem2`.

- `--whitelist WHITELIST`
  - **Description**: 10x whitelist file.

- `--read_structure READ_STRUCTURE`
  - **Description**: Read structure.

- `--barcode_orientation BARCODE_ORIENTATION`
  - **Description**: Barcode orientation.

- `--sample_id SAMPLE_ID`
  - **Description**: Sample ID.

- `--output_format OUTPUT_FORMAT`
  - **Description**: Output format.

### File Size and Execution Mode
- `-b BAM_SIZE`, `--bam_size BAM_SIZE`
  - **Description**: BAM file size in GB.

- `--mode MODE`
  - **Description**: Execution mode options:
    - `flatmode`: Just BWA without sorting, creates SAM files equal to the number of ranks created.
    - `sortedbam`: BWA + SAM sorting steps, creating a single BAM file as output.
    - `fqprocessonly`: Custom processing of fastq files.
    - `multifq`: Custom multifastq processing.

### Read Type Options
- `--read_type READ_TYPE`
  - **Description**: Specifies the type of reads for alignment:
    - `short`: BWA-MEM2 alignment with short reads (default).
    - `long`: MM2-fast alignment with long reads.

### Indexing Options
- `--rindex`
  - **Description**: Enables BWA-MEM2 index generation. Use this option if the index is not present.

- `--dindex`
  - **Description**: Creates a reference genome FAI index. Use this option if the reference FAI is not present.

### Additional Options
- `--profile`
  - **Description**: Enables profiling.

- `--not_keep_unmapped`
  - **Description**: Rejects unmapped reads at the end of the sorted BAM file. If not specified, unmapped reads are retained.

- `--keep_sam`
  - **Description**: Retains intermediate SAM files generated by the alignment tool for each rank. SAM files are named as `aln{rank:04d}.sam`.

- `--params PARAMS`
  - **Description**: Allows supplying various parameters to BWA-MEM2 (except the `-t` parameter for threads). Example:
    ```
    --params '-R "@RG\tID:RG1\tSM:RGSN1"'
    ```
    This enables read grouping.

- `--sso`
  - **Description**: Executes the pipeline on a single socket only. By default, all sockets are used.

### Resource Allocation
- `--th TH`
  - **Description**: Sets the threshold for the minimum number of cores allocated to each rank.

- `-N N`
  - **Description**: Manually sets the number of ranks. When using this, set `PPN` and `cpus` options accordingly.

- `-PPN PPN`
  - **Description**: Manually sets the number of processes per node (PPN). When using this, set `N` and `cpus` options accordingly.

- `--cpus CPUS`
  - **Description**: Manually sets the number of CPUs. When using this, set `N` and `PPN` options accordingly.

---

## Example Usage
```bash
python pipeline.py \
  --ref /path/to/reference.fasta \
  --reads read1.fastq read2.fastq \
  --tempdir /path/to/tempdir \
  --output /path/to/output \
  --simd avx512 \
  --mode sortedbam \
  --read_type short
```

